<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>aiwa pb-3 battery replacement</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>aiwa pb-3 battery replacement</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_specs">1. Specs</a></li>
<li><a href="#_safety">2. Safety</a></li>
<li><a href="#_reverse_engineering_notes">3. Reverse Engineering Notes</a>
<ul class="sectlevel2">
<li><a href="#_pb_3_reverse_engineering_notebook">3.1. PB-3 Reverse-Engineering Notebook</a>
<ul class="sectlevel3">
<li><a href="#_objective">3.1.1. Objective</a></li>
<li><a href="#_what_is_known_today">3.1.2. What is Known Today</a></li>
<li><a href="#_research_findings">3.1.3. Research Findings</a>
<ul class="sectlevel4">
<li><a href="#_stereo2go_thread_highlights">3.1.3.1. Stereo2Go thread highlights</a></li>
<li><a href="#_derived_requirements">3.1.3.2. Derived Requirements</a></li>
</ul>
</li>
<li><a href="#_host_deck_reality">3.1.4. Host Deck Reality</a></li>
<li><a href="#_research_to_do_list">3.1.5. Research To-Do List</a></li>
<li><a href="#_proposed_replacement_strategy">3.1.6. Proposed Replacement Strategy</a></li>
<li><a href="#_electrical_block_requirements">3.1.7. Electrical Block Requirements</a></li>
<li><a href="#_mechanical_considerations">3.1.8. Mechanical Considerations</a></li>
<li><a href="#_living_cad_automation">3.1.9. Living CAD + Automation</a></li>
<li><a href="#_reverse_engineering_workflow">3.1.10. Reverse-Engineering Workflow</a></li>
<li><a href="#_future_kicad_artifacts">3.1.11. Future KiCad Artifacts</a></li>
<li><a href="#_validation_test_plan">3.1.12. Validation &amp; Test Plan</a></li>
<li><a href="#_open_questions">3.1.13. Open Questions</a></li>
<li><a href="#_next_immediate_steps">3.1.14. Next Immediate Steps</a></li>
</ul>
</li>
<li><a href="#_measuring_the_pb_3_and_context">3.2. Measuring the PB-3 and context</a>
<ul class="sectlevel3">
<li><a href="#_measurement_photos">3.2.1. Measurement Photos</a>
<ul class="sectlevel4">
<li><a href="#_original_pb_3_sla_pack">3.2.1.1. Original PB-3 SLA pack</a>
<ul class="sectlevel5">
<li><a href="#_width_67_73_67_75">3.2.1.1.1. Width [67.73, 67.75]</a></li>
<li><a href="#_height_8_19_8_12">3.2.1.1.2. Height [8.19, 8.12]</a></li>
<li><a href="#_depth_17_65_17_55">3.2.1.1.3. Depth [17.65, 17.55]</a></li>
</ul>
</li>
<li><a href="#_battery_holder">3.2.1.2. Battery holder</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_architecture_decisions">4. Architecture Decisions</a>
<ul class="sectlevel2">
<li><a href="#_architecture_decision_records">4.1. Architecture Decision Records</a>
<ul class="sectlevel3">
<li><a href="#_philosophy">4.1.1. Philosophy</a></li>
<li><a href="#_what">4.1.2. What</a></li>
<li><a href="#_why">4.1.3. Why</a></li>
<li><a href="#_format">4.1.4. Format</a></li>
<li><a href="#_index">4.1.5. Index</a>
<ul class="sectlevel4">
<li><a href="#_adr_001_commit_generated_artifacts_next_to_source">4.1.5.1. ADR-001: Commit Generated Artifacts Next to Source</a>
<ul class="sectlevel5">
<li><a href="#_context">4.1.5.1.1. Context</a></li>
<li><a href="#_decision">4.1.5.1.2. Decision</a></li>
<li><a href="#_alternatives">4.1.5.1.3. Alternatives</a></li>
<li><a href="#_implications">4.1.5.1.4. Implications</a></li>
<li><a href="#_files_affected">4.1.5.1.5. Files Affected</a></li>
</ul>
</li>
<li><a href="#_adr_002_use_text_based_cad_and_documentation_formats">4.1.5.2. ADR-002: Use Text-Based CAD and Documentation Formats</a>
<ul class="sectlevel5">
<li><a href="#_context_2">4.1.5.2.1. Context</a></li>
<li><a href="#_decision_2">4.1.5.2.2. Decision</a></li>
<li><a href="#_alternatives_2">4.1.5.2.3. Alternatives</a></li>
<li><a href="#_implications_2">4.1.5.2.4. Implications</a></li>
<li><a href="#_examples">4.1.5.2.5. Examples</a></li>
<li><a href="#_tools_used">4.1.5.2.6. Tools Used</a></li>
</ul>
</li>
<li><a href="#_adr_003_use_github_actions_for_all_build_automation">4.1.5.3. ADR-003: Use GitHub Actions for All Build Automation</a>
<ul class="sectlevel5">
<li><a href="#_context_3">4.1.5.3.1. Context</a></li>
<li><a href="#_decision_3">4.1.5.3.2. Decision</a></li>
<li><a href="#_alternatives_3">4.1.5.3.3. Alternatives</a></li>
<li><a href="#_implications_3">4.1.5.3.4. Implications</a></li>
<li><a href="#_why_not_magic">4.1.5.3.5. Why Not Magic</a></li>
<li><a href="#_workflow_structure">4.1.5.3.6. Workflow Structure</a></li>
<li><a href="#_traceability_example">4.1.5.3.7. Traceability Example</a></li>
<li><a href="#_living_documentation">4.1.5.3.8. Living Documentation</a></li>
<li><a href="#_tools_vs_process">4.1.5.3.9. Tools vs Process</a></li>
</ul>
</li>
<li><a href="#_adr_004_file_extension_conventions_for_main_vs_include_files">4.1.5.4. ADR-004: File Extension Conventions for Main vs Include Files</a>
<ul class="sectlevel5">
<li><a href="#_context_4">4.1.5.4.1. Context</a></li>
<li><a href="#_decision_4">4.1.5.4.2. Decision</a></li>
<li><a href="#_alternatives_4">4.1.5.4.3. Alternatives</a></li>
<li><a href="#_implications_4">4.1.5.4.4. Implications</a></li>
<li><a href="#_examples_2">4.1.5.4.5. Examples</a></li>
<li><a href="#_directory_structure">4.1.5.4.6. Directory Structure</a></li>
<li><a href="#_ci_impact">4.1.5.4.7. CI Impact</a></li>
</ul>
</li>
<li><a href="#_adr_005_conditional_imagesdir_management_for_book_assembly">4.1.5.5. ADR-005: Conditional imagesdir Management for Book Assembly</a>
<ul class="sectlevel5">
<li><a href="#_context_5">4.1.5.5.1. Context</a></li>
<li><a href="#_decision_5">4.1.5.5.2. Decision</a></li>
<li><a href="#_alternatives_5">4.1.5.5.3. Alternatives</a></li>
<li><a href="#_implications_5">4.1.5.5.4. Implications</a></li>
<li><a href="#_pattern">4.1.5.5.5. Pattern</a></li>
<li><a href="#_files_using_pattern">4.1.5.5.6. Files Using Pattern</a></li>
<li><a href="#_why_saverestore">4.1.5.5.7. Why Save/Restore</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_credits">5. Credits</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>USB-C rechargeable LiPo replacement for the AIWA PB-3/PB-4 battery pack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specs">1. Specs</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Original PB-3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This Design</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chemistry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lead-acid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LiPo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cell voltage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.7V nominal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output voltage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0V (adjustable 2.0-2.4V)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">470mAh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500-1500mAh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proprietary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB-C 5V</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_safety">2. Safety</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Buck DC-DC steps 3.7V → 2.4V</p>
</li>
<li>
<p><strong>OVP (Zener/TVS)</strong> clamps output &lt;3V if buck fails</p>
</li>
<li>
<p>DW01A+FS8205A BMS: OV/UV/OC protection</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reverse_engineering_notes">3. Reverse Engineering Notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pb_3_reverse_engineering_notebook">3.1. PB-3 Reverse-Engineering Notebook</h3>
<div class="sect3">
<h4 id="_objective">3.1.1. Objective</h4>
<div class="paragraph">
<p>Build a present-day PB-3 pack that wakes an AIWA HS-PC202MII. That deck is the primary test bed and end user. The wall wart is missing, the stock SLA is dead, and donor packs only exist as forum photos, so every measurement and assumption comes from images plus clone teardowns.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_is_known_today">3.1.2. What is Known Today</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Topic</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Confidence</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mechanical envelope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Caliper photos show 68 mm × 17.8 mm × 8 mm overall and a 52 mm × 15 mm × 6 mm cell bay. Thin plastic shell, PCB island at the connector end with fuse and ballast resistor.<sup class="footnote" id="_footnote_meas">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High. Need one more sample to average tolerance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Electrical interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-pin keyed blade plus PB-4 top pads. Clone pack shows 3.67 V LiPo feeding a converter that outputs 2.41 V on the blades; wiring solders directly to the IC pins.<sup class="footnoteref red" title="Unresolved footnote reference.">[s2g]</sup> HS-PC202MII schematic is unavailable, so reverse engineering relies on photos and continuity tests once the clone arrives.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low. Need deck-side schematic to confirm charge routine and pinout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chemistry and capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Original PB-3 spec sheet rated 470 mAh SLA. Community teardowns hint at 700–800 mAh service packs, but clones today ship 500 mAh LiPo with buck down to 2.4 V.<sup class="footnoteref red" title="Unresolved footnote reference.">[s2g]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium. Need an unopened OEM cell for proof.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Community precedents</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baidu and Stereo2Go builds use 3D-printed shells plus Li-ion or LiPo stages, usually without fault clamps or plated blades.<sup class="footnoteref red" title="Unresolved footnote reference.">[s2g]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High. Reuse photos only with permission.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_research_findings">3.1.3. Research Findings</h4>
<div class="sect4">
<h5 id="_stereo2go_thread_highlights">3.1.3.1. Stereo2Go thread highlights</h5>
<div class="ulist">
<ul>
<li>
<p>AliExpress PB-3/PB-4 USB-C pack runs £14, lists 900 mAh, hides 500 mAh LiPo, spits 3.67 V raw and 2.41 V at the blades.<sup class="footnote" id="_footnote_s2g">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Shell size is 68 mm × 17.8 mm × 8 mm. Battery cavity maxes at 52 mm × 15 mm × 6 mm, so 500 mAh is the ceiling until cells improve.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>3D printed case flexes, screw bosses die fast, only top contacts get plating.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Pack leads land right on converter pins. Bare copper hovers over inductors. No strain relief.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>If the buck converter fails, the deck eats the full 3.7 V. Need a clamp or crowbar that kills the fault.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>PB-S5 board is the same. Swap the marked 100 kΩ resistor for 120 kΩ to hit 2.1 V. 0603 footprint.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Search phrase "500mAh lipo battery 6mm" finds cells that fit; nothing larger ships yet.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Wickedkraft sells a pricier variant on eBay. No autopsy yet but likely the same guts.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_derived_requirements">3.1.3.2. Derived Requirements</h5>
<div class="ulist">
<ul>
<li>
<p>USB-C charging. Retire the fragile Aiwa wall wart.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Runtime must beat the 470 mAh SLA. Target &gt;900 mAh effective at 2V output.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Respect 68 mm × 17.8 mm × 8 mm overall and 52 mm × 15 mm × 6 mm cell cavity. Keep PB-4 top contacts alive.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Plate every blade. Reinforce the connector window so owners stop snapping plastic.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Terminate the cell on pads with relief. No bare wires surfing active parts.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>Add a fault clamp so output never drifts past 2.4 V even if the buck fails. Make PB-S5 vs PB-3 voltage a resistor change.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_host_deck_reality">3.1.4. Host Deck Reality</h4>
<div class="ulist">
<ul>
<li>
<p>Runner: AIWA HS-PC202MII. This deck will see every prototype first and is the reason the project exists.</p>
</li>
<li>
<p>Constraints: OEM wall wart is missing, OEM PB-3 pack is dead, and voltage measurements of it are not relevant (0v). Reverse engineering starts with images of clone PCBs.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_research_to_do_list">3.1.5. Research To-Do List</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Imagery</strong>: pull clean teardown photos from Baidu Tieba (<code>随身听 PB-3</code>) and Japanese blogs. Capture rulers or redraw.</p>
</li>
<li>
<p><strong>Connector survey</strong>: borrow a PB-3 pack or host deck. Log pitch, depth, retention, plating.</p>
</li>
<li>
<p><strong>Power sweep</strong>: record float voltage, discharge curve, deck charge current while the donor SLA still lives (if there is one which there isn&#8217;t).</p>
</li>
<li>
<p><strong>Archive</strong>: dump every measurement, photo, and trace into this repo before CAD starts.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_proposed_replacement_strategy">3.1.6. Proposed Replacement Strategy</h4>
<div class="paragraph">
<p>SLA is dead weight. Teardown of Aliexpress clone confirms the working approach.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>LiPo 1S (3.7V nominal) + buck to 2.0V</strong></dt>
<dd>
<p>+ Matches existing clone design (LAOWANG_DIY board)
+ 500mAh cell → 900mAh effective at 2V output
+ Buck topology (step-down) matches 3.7V→2.0V requirement
+ BMS often on cell flex PCB</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Baseline design: <strong>1S LiPo 500mAh + buck converter regulated at 2.0V</strong> matching the original PB-3 output.</p>
</div>
</div>
<div class="sect3">
<h4 id="_electrical_block_requirements">3.1.7. Electrical Block Requirements</h4>
<div class="ulist">
<ul>
<li>
<p>Cell: 500mAh LiPo pouch, ~6mm thick, matches 52×15×6mm cavity</p>
</li>
<li>
<p>BMS: On cell flex PCB (clone) or discrete DW01A+FS8205 (our design)</p>
</li>
<li>
<p>Buck: SOT-23-6 IC, 2.2µH inductor, configured for 2.0V output</p>
</li>
<li>
<p>Rfb: 100k = 2.4V, 120k = 2.1V (per Stereo2Go mod). Adjust for 2.0V target.</p>
</li>
<li>
<p>Charge path: USB-C 5V → charger IC (SOT-23-6) → CC/CV 4.2V to cell</p>
</li>
<li>
<p>OVP: Zener/TVS clamp &lt;3V to protect deck if buck fails (improvement over clone)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mechanical_considerations">3.1.8. Mechanical Considerations</h4>
<div class="ulist">
<ul>
<li>
<p>Stay inside the original outline so the bay latch still works. 0.8 mm FR-4 maximizes cell room.</p>
</li>
<li>
<p>Scan or caliper a donor shell. Build a STEP model for interference checks.</p>
</li>
<li>
<p>Reuse the original keyed blade if possible. If not, design a flex tail or custom edge connector footprint.</p>
</li>
<li>
<p>Rough CAD now lives in <code>openscad/pb3-pack.scad</code> (OpenSCAD). Dimensions trace back to <code>measurements/IMG_9373.jpeg</code>–<code>IMG_9385.jpeg</code> plus the Stereo2Go thread captured in <code>research/</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">First Solid CAD Model</div>
<div class="content">
<pre class="highlight"><code class="language-scad" data-lang="scad">// PB-3 battery pack simplification: single solid block matching the outer envelope.
// Dimensions drawn from measurement photos (measurements/IMG_9373.jpeg–IMG_9385.jpeg)
// and the Stereo2Go teardown cached in research/.
// Units: millimetres.

module pb3_pack_fitting_test() {
    outer_len = 68; 
    outer_width = 17.8;
    outer_height = 8;
    textH=.5; textS=10;
    wiggle=.01;
    difference(){
        cube([outer_len, outer_width, outer_height]);
        translate([textS/2, outer_width/2,outer_height-textH]) linear_extrude(.5+wiggle) text("v0.1",size=textS,valign="center");
    }
}

pb3_pack_fitting_test();
// To test fitting, run OpenSCAD and export to STL. Then 3D print a test block to verify fit in the PB-3 housing.</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="subdoc/openscad/pb3-pack.png" alt="pb3 pack">
</div>
<div class="title">Figure 1. output image</div>
</div>
</div>
<div class="sect3">
<h4 id="_living_cad_automation">3.1.9. Living CAD + Automation</h4>
<div class="ulist">
<ul>
<li>
<p><code>openscad/pb3-pack.scad</code> is the print gauge. Version is embossed on the block so prints always tell you which assumption set they follow.</p>
</li>
<li>
<p><code>kicad/pb3-replacement.kicad_pro</code> (plus <code>.kicad_sch</code>/<code>.kicad_pcb</code>) tracks the electrical build. It is tagged V0.1 in the title blocks so KiCad exports line up with the physical gauges.</p>
</li>
<li>
<p><code>.github/workflows/cad-build.yml</code> is the single entry workflow. Jobs: <code>openscad</code>, <code>plantuml</code>, <code>kicad</code> → <code>publish</code> which copies artifacts into <code>docs/generated/</code> and commits.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reverse_engineering_workflow">3.1.10. Reverse-Engineering Workflow</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>De-pot a PB-3 with heat and patience. Photograph each layer.</p>
</li>
<li>
<p>Trace the PCB. Mark every component, resistor, and fuse.</p>
</li>
<li>
<p>Recreate the old schematic in KiCad. Understand what the deck expects before changing it.</p>
</li>
<li>
<p>Map new requirements against the host behavior.</p>
</li>
<li>
<p>Draft hierarchical KiCad sheets: Cell+BMS, Buck, Connector/NTC. Assign refs early.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_future_kicad_artifacts">3.1.11. Future KiCad Artifacts</h4>
<div class="ulist">
<ul>
<li>
<p><code>kicad/pb3-replacement.kicad_pro</code> — full project.</p>
</li>
<li>
<p><code>mechanical/pb3-shell.step</code> — shell model for fit checks.</p>
</li>
<li>
<p><code>library/connector_aiwa_pb3.kicad_mod</code> — blade footprint.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_validation_test_plan">3.1.12. Validation &amp; Test Plan</h4>
<div class="paragraph">
<p><strong>Functional</strong>
* Charge through USB-C. Log voltage and current curves.
* Run a hungry deck like HS-PX505. Verify buck holds 2.0V ±0.1V during FF/REW.
* Measure output with multimeter: target 2.0V (orig PB-3) or 2.4V (clone default).</p>
</div>
<div class="paragraph">
<p><strong>Safety</strong>
* Bake at 40 °C ambient. Keep silicon &lt;85 °C.
* Trip short-circuit protection under 20 ms.</p>
</div>
<div class="paragraph">
<p><strong>Documentation</strong>
* Export schematic PDFs and BOM straight from KiCad.
* Keep PlantUML diagrams in <code>images/</code> so architecture matches the board.</p>
</div>
</div>
<div class="sect3">
<h4 id="_open_questions">3.1.13. Open Questions</h4>
<div class="ulist">
<ul>
<li>
<p>Do any decks sniff a third pin? Need proof before adding logic.</p>
</li>
<li>
<p>Does the host trickle charge while on AC? Impacts design.</p>
</li>
<li>
<p>Did Aiwa rely on SLA resistance rise for end-of-life? Might need a small gauge IC to mimic it.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_next_immediate_steps">3.1.14. Next Immediate Steps</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Source a PB-3 donor for teardown.</p>
</li>
<li>
<p>Measure connector plating and friction.</p>
</li>
<li>
<p>Spin initial KiCad sheets with placeholders.</p>
</li>
<li>
<p>Prototype the buck on eval hardware and log noise against the audio path.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_measuring_the_pb_3_and_context">3.2. Measuring the PB-3 and context</h3>
<div class="paragraph">
<p>This directory holds every measurement photo, caliper log, and derived dimension used to build the PB-3 models.</p>
</div>
<div class="sect3">
<h4 id="_measurement_photos">3.2.1. Measurement Photos</h4>
<div class="sect4">
<h5 id="_original_pb_3_sla_pack">3.2.1.1. Original PB-3 SLA pack</h5>
<div class="sect5">
<h6 id="_width_67_73_67_75">3.2.1.1.1. Width [67.73, 67.75]</h6>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9373.jpeg" alt="IMG 9373">
</div>
<div class="title">Figure 2. Width calipered underside (67.73mm)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9374.jpeg" alt="IMG 9374">
</div>
<div class="title">Figure 3. Width calipered top (67.75mm)</div>
</div>
</div>
<div class="sect5">
<h6 id="_height_8_19_8_12">3.2.1.1.2. Height [8.19, 8.12]</h6>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9375.jpeg" alt="IMG 9375">
</div>
<div class="title">Figure 4. Height calipered side (8.19mm)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9378.jpeg" alt="IMG 9378">
</div>
<div class="title">Figure 5. Height calipered side (8.12mm)</div>
</div>
</div>
<div class="sect5">
<h6 id="_depth_17_65_17_55">3.2.1.1.3. Depth [17.65, 17.55]</h6>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9376.jpeg" alt="IMG 9376">
</div>
<div class="title">Figure 6. Depth calipered top (17.65mm)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9377.jpeg" alt="IMG 9377">
</div>
<div class="title">Figure 7. Depth calipered top (17.55mm)</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_battery_holder">3.2.1.2. Battery holder</h5>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9379.jpeg" alt="IMG 9379">
</div>
<div class="title">Figure 8. battery holder Depth</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9380.jpeg" alt="IMG 9380">
</div>
<div class="title">Figure 9. battery holder Width</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9381.jpeg" alt="IMG 9381">
</div>
<div class="title">Figure 10. battery holder Height</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9382.jpeg" alt="IMG 9382">
</div>
<div class="title">Figure 11. battery holder inside view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9383.jpeg" alt="IMG 9383">
</div>
<div class="title">Figure 12. battery holder inside view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9384.jpeg" alt="IMG 9384">
</div>
<div class="title">Figure 13. battery holder inside view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="measurements/IMG_9385.jpeg" alt="IMG 9385">
</div>
<div class="title">Figure 14. battery holder inside view</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture_decisions">4. Architecture Decisions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_architecture_decision_records">4.1. Architecture Decision Records</h3>
<div class="sect3">
<h4 id="_philosophy">4.1.1. Philosophy</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Hemingway</dt>
<dd>
<p>Short sentences. No fluff. Say it once.</p>
</dd>
<dt class="hdlist1">DRY (Don&#8217;t Repeat Yourself)</dt>
<dd>
<p>Write once. Reference everywhere. No copy-paste.</p>
</dd>
<dt class="hdlist1">KISS (Keep It Simple, Stupid)</dt>
<dd>
<p>Simple beats clever. If you need comments, simplify.</p>
</dd>
<dt class="hdlist1">NO MAGIC</dt>
<dd>
<p>Explicit over implicit. No hidden behavior. No surprises.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_what">4.1.2. What</h4>
<div class="paragraph">
<p>ADRs document <strong>why</strong> we chose this over that.</p>
</div>
<div class="paragraph">
<p>Each record:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>States the decision</p>
</li>
<li>
<p>Lists alternatives considered</p>
</li>
<li>
<p>Explains consequences</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_why">4.1.3. Why</h4>
<div class="paragraph">
<p>Memory fades. Context dies. ADRs preserve intent.</p>
</div>
<div class="paragraph">
<p>When someone asks "why this way?", point to the ADR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_format">4.1.4. Format</h4>
<div class="listingblock">
<div class="title">ADR template</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">= ADR-NNN: Title

Date: YYYY-MM-DD
Status: Accepted | Deprecated | Superseded

== Context
Problem statement. One paragraph.

== Decision
What we chose. One sentence.

== Alternatives
- Option A: why rejected
- Option B: why rejected

== Implications
+ Good consequence
+ Good consequence
- Bad consequence
- Mitigation for bad consequence</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_index">4.1.5. Index</h4>
<div class="sect4">
<h5 id="_adr_001_commit_generated_artifacts_next_to_source">4.1.5.1. ADR-001: Commit Generated Artifacts Next to Source</h5>
<div class="paragraph">
<p>Date: 2025-12-12<br>
Status: Accepted</p>
</div>
<div class="sect5">
<h6 id="_context">4.1.5.1.1. Context</h6>
<div class="paragraph">
<p>This repo is a reverse engineering workbook. PlantUML diagrams, OpenSCAD models, KiCad schematics are both source <strong>and</strong> documentation. End users clone the repo to read design history, not to rebuild artifacts.</p>
</div>
<div class="paragraph">
<p>Generated outputs (PNG, STL, PDF) answer: "What does this look like?" Keeping them divorced from source breaks context. Viewing design requires tools. History loses meaning without rendered outputs.</p>
</div>
</div>
<div class="sect5">
<h6 id="_decision">4.1.5.1.2. Decision</h6>
<div class="paragraph">
<p>Commit generated artifacts next to their source files.</p>
</div>
</div>
<div class="sect5">
<h6 id="_alternatives">4.1.5.1.3. Alternatives</h6>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Separate <code>docs/generated/</code> directory</strong></dt>
<dd>
<p>+ Clean source tree
+ CI manages all outputs</p>
<div class="ulist">
<ul>
<li>
<p>Divorces outputs from source context</p>
</li>
<li>
<p>Requires CI to view design</p>
</li>
<li>
<p>Clone without CI = incomplete artifact</p>
</li>
<li>
<p>AsciiDoc references break (<code>image::openscad/foo.png</code> fails if PNG lives in <code>docs/</code>)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Ignore all generated files</strong></dt>
<dd>
<p>+ Smallest repo
+ No merge conflicts on binaries</p>
<div class="ulist">
<ul>
<li>
<p>Useless offline</p>
</li>
<li>
<p>GitHub PR can&#8217;t show visual diffs</p>
</li>
<li>
<p>Design evolution invisible in history</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Submodule for outputs</strong></dt>
<dd>
<p>+ Separates binary history</p>
<div class="ulist">
<ul>
<li>
<p>Overcomplicated for solo project</p>
</li>
<li>
<p>Two clones to see one design</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_implications">4.1.5.1.4. Implications</h6>
<div class="paragraph">
<p><strong>Positive:</strong></p>
</div>
<div class="paragraph">
<p>+ <code>openscad/pb3-pack.png</code> lives next to <code>openscad/pb3-pack.scad</code>
+ AsciiDoc <code>image::</code> paths match file tree
+ Offline clone shows design without rebuilding
+ GitHub renders PNGs inline in PRs
+ History shows design evolution (old PNG = old intent)
+ No CI dependency for documentation</p>
</div>
<div class="paragraph">
<p><strong>Negative:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Repo size grows with each design iteration</p>
</li>
<li>
<p>Merge conflicts possible on binary files (rare for solo)</p>
</li>
<li>
<p>CI must commit and push outputs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mitigations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keep STL/PNG &lt;5MB each (current sizes: &lt;500KB)</p>
</li>
<li>
<p>Use <code>git lfs</code> if files exceed 10MB</p>
</li>
<li>
<p>CI commits with <code>[skip ci]</code> to avoid recursion</p>
</li>
<li>
<p>For huge experimental outputs, use scratch <code>build/</code> dirs (gitignored)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_files_affected">4.1.5.1.5. Files Affected</h6>
<div class="paragraph">
<p>Source directories commit their outputs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>openscad/*.{stl,png}</code> — rendered models</p>
</li>
<li>
<p><code>images/*.{png,svg}</code> — diagram exports</p>
</li>
<li>
<p><code>kicad/*.{pdf,svg}</code> — schematic/board renders</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CI workflow updated to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate artifacts into source directories</p>
</li>
<li>
<p>Commit outputs back to repo</p>
</li>
<li>
<p>Push to main branch</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Scratch builds (local experiments) use <code>*/build/</code> and remain gitignored.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adr_002_use_text_based_cad_and_documentation_formats">4.1.5.2. ADR-002: Use Text-Based CAD and Documentation Formats</h5>
<div class="paragraph">
<p>Date: 2025-12-12<br>
Status: Accepted</p>
</div>
<div class="sect5">
<h6 id="_context_2">4.1.5.2.1. Context</h6>
<div class="paragraph">
<p>Reverse engineering requires clear, searchable, versionable documentation. Design intent must survive iteration. Ambiguity kills projects. Binary formats (PNG, SVG, proprietary CAD) hide structure, resist search, and depend on artistic interpretation.</p>
</div>
<div class="paragraph">
<p>Need tools that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Version cleanly in git</p>
</li>
<li>
<p>Search with grep</p>
</li>
<li>
<p>Feed to LLMs without image parsing</p>
</li>
<li>
<p>Embed measurements explicitly</p>
</li>
<li>
<p>Avoid subjective interpretation</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_decision_2">4.1.5.2.2. Decision</h6>
<div class="paragraph">
<p>Use text-based formats for all CAD and documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AsciiDoc</strong> for all docs</p>
</li>
<li>
<p><strong>PlantUML</strong> for block diagrams</p>
</li>
<li>
<p><strong>OpenSCAD</strong> for mechanical models</p>
</li>
<li>
<p><strong>KiCad</strong> for PCB (S-expression text format)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_alternatives_2">4.1.5.2.3. Alternatives</h6>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Binary formats (Visio, Fusion 360, PNG diagrams)</strong></dt>
<dd>
<p>+ Industry standard tools
+ Rich GUI workflows</p>
<div class="ulist">
<ul>
<li>
<p>Not searchable (grep useless)</p>
</li>
<li>
<p>Binary diffs meaningless</p>
</li>
<li>
<p>LLM can&#8217;t parse structure</p>
</li>
<li>
<p>Locked to specific tools</p>
</li>
<li>
<p>Measurements hidden in pixels</p>
</li>
<li>
<p>Interpretation varies by viewer</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Markdown + hand-drawn SVG</strong></dt>
<dd>
<p>+ Simple, portable</p>
<div class="ulist">
<ul>
<li>
<p>SVG is XML (verbose, hard to write)</p>
</li>
<li>
<p>Hand-drawn = ambiguous dimensions</p>
</li>
<li>
<p>No parametric models</p>
</li>
<li>
<p>Design intent lost in pixels</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Wiki or Google Docs</strong></dt>
<dd>
<p>+ Collaborative
+ Rich media</p>
<div class="ulist">
<ul>
<li>
<p>Not in git (history scattered)</p>
</li>
<li>
<p>Export fragile</p>
</li>
<li>
<p>Offline broken</p>
</li>
<li>
<p>Search locked to platform</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_implications_2">4.1.5.2.4. Implications</h6>
<div class="paragraph">
<p><strong>Positive:</strong></p>
</div>
<div class="paragraph">
<p>+ <code>grep "68.*17.8.*8" openscad/</code> finds all references to pack dimensions
+ <code>git diff</code> shows exact measurement changes: <code>outer_len = 67</code> → <code>outer_len = 68</code>
+ LLM can ingest <code>.puml</code> and suggest corrections: "2.4V output conflicts with 2.0V spec"
+ PlantUML connections are explicit: <code>CELL -&#8594; BUCK : 3.0-4.2V</code> (no guessing from arrows)
+ OpenSCAD embeds tolerances: <code>wiggle=.01</code> (visible in source, not CAD property panel)
+ KiCad <code>.kicad_sch</code> is S-expression: searchable for part numbers, net names
+ Docs live next to code: <code>openscad/pb3-pack.scad</code> + README.asciidoc in same commit
+ Dead docs impossible: if code changes, doc changes (same file or adjacent)
+ No priest needed: <code>outer_len = 68</code> means 68mm, not "roughly this wide"</p>
</div>
<div class="paragraph">
<p><strong>Negative:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Steeper learning curve (PlantUML syntax, OpenSCAD code)</p>
</li>
<li>
<p>No WYSIWYG (must render to see)</p>
</li>
<li>
<p>Collaboration requires text-editing skill</p>
</li>
<li>
<p>Binary export still needed for viewing (PNG, STL)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mitigations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>CI auto-generates viewable outputs (PNG, STL, PDF) from text sources</p>
</li>
<li>
<p>Commit both source and renders (ADR-001)</p>
</li>
<li>
<p>Include examples in repo (<code>images/pb3-architecture.plantuml</code> as template)</p>
</li>
<li>
<p>LLMs can write PlantUML/OpenSCAD from specs (reverse engineering ally)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_examples">4.1.5.2.5. Examples</h6>
<div class="paragraph">
<p><strong>Searchable dimensions:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-scad" data-lang="scad">outer_len = 68;    // grep finds this
outer_width = 17.8;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Explicit connections:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-plantuml" data-lang="plantuml">CELL --&gt; BUCK : 3.0-4.2V  // no guessing voltage
BUCK --&gt; OUT : 2.0V       // explicit output</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Versionable structure:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-diff" data-lang="diff">- BUCK --&gt; OUT : 2.4V
+ BUCK --&gt; OUT : 2.0V  // git diff shows intent change</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>LLM-friendly input:</strong>
"Here&#8217;s the PlantUML. Does the 2.0V output match the schematic&#8217;s buck feedback resistor?"</p>
</div>
</div>
<div class="sect5">
<h6 id="_tools_used">4.1.5.2.6. Tools Used</h6>
<div class="ulist">
<ul>
<li>
<p>AsciiDoc: prose, specs, workbook</p>
</li>
<li>
<p>PlantUML: block diagrams, architecture</p>
</li>
<li>
<p>OpenSCAD: mechanical models, fit tests</p>
</li>
<li>
<p>KiCad: schematic + PCB (text-based S-expression format)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All text. All searchable. All versionable. All LLM-ingestible.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adr_003_use_github_actions_for_all_build_automation">4.1.5.3. ADR-003: Use GitHub Actions for All Build Automation</h5>
<div class="paragraph">
<p>Date: 2025-12-12<br>
Status: Superseded by ADR-006 (single job pipeline)</p>
</div>
<div class="sect5">
<h6 id="_context_3">4.1.5.3.1. Context</h6>
<div class="paragraph">
<p>Generated artifacts (PNG, STL, PDF) must stay synchronized with source files. Manual builds fail. Developers forget to regenerate. Wrong versions ship. "It works on my machine" breaks collaboration.</p>
</div>
<div class="paragraph">
<p>Need automation that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Runs on every commit</p>
</li>
<li>
<p>Links builds to exact source version</p>
</li>
<li>
<p>Prevents stale outputs</p>
</li>
<li>
<p>Documents build process explicitly</p>
</li>
<li>
<p>Survives author memory loss</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_decision_3">4.1.5.3.2. Decision</h6>
<div class="paragraph">
<p>Use GitHub Actions for all CAD rendering and artifact generation.</p>
</div>
<div class="paragraph">
<p>No local build scripts as primary workflow.</p>
</div>
</div>
<div class="sect5">
<h6 id="_alternatives_3">4.1.5.3.3. Alternatives</h6>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Local build scripts only</strong></dt>
<dd>
<p>+ Fast iteration
+ No network dependency</p>
<div class="ulist">
<ul>
<li>
<p>Forget to run = stale outputs committed</p>
</li>
<li>
<p>"Works on my machine" inconsistencies</p>
</li>
<li>
<p>Process lives in author&#8217;s head</p>
</li>
<li>
<p>New contributor: "How do I build?"</p>
</li>
<li>
<p>No proof outputs match sources</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Manual screenshot/export workflow</strong></dt>
<dd>
<p>+ Simple tools
+ No scripting</p>
<div class="ulist">
<ul>
<li>
<p>Wrong version screenshots plague repos</p>
</li>
<li>
<p>No traceability (which source made this PNG?)</p>
</li>
<li>
<p>Forgot to save = weeks hunting mismatch</p>
</li>
<li>
<p>Undocumented steps = tribal knowledge</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Pre-commit hooks</strong></dt>
<dd>
<p>+ Automatic on commit</p>
<div class="ulist">
<ul>
<li>
<p>Slow local commits (blocks developer)</p>
</li>
<li>
<p>Hard to debug when broken</p>
</li>
<li>
<p>Environmental differences break hooks</p>
</li>
<li>
<p>Still local = "works on my machine"</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Makefile + CI</strong></dt>
<dd>
<p>+ Standard Unix pattern
+ Local + remote builds</p>
<div class="ulist">
<ul>
<li>
<p>Two build paths = drift risk</p>
</li>
<li>
<p>Makefile syntax arcane</p>
</li>
<li>
<p>Windows developers struggle</p>
</li>
<li>
<p>Process still partly hidden</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_implications_3">4.1.5.3.4. Implications</h6>
<div class="paragraph">
<p><strong>Positive:</strong></p>
</div>
<div class="paragraph">
<p>+ <strong>Sync guaranteed</strong>: outputs regenerated every push, impossible to commit stale PNG
+ <strong>Traceable</strong>: Actions log links to exact commit that built artifact
+ <strong>Documented workflow</strong>: <code>.github/workflows/cad-build.yml</code> IS the build documentation
+ <strong>Preview while editing</strong>: PlantUML/OpenSCAD extensions show live preview in VS Code, no surprise when CI builds
+ <strong>Repeatable</strong>: same Docker images, same results, always
+ <strong>Inspectable</strong>: workflow file shows thought process: "first OpenSCAD, then PlantUML, then publish"
+ <strong>No magic</strong>: workflow is code, not author&#8217;s mental model requiring MRI to extract
+ <strong>Works-on-merge</strong>: GitHub Actions runs on forks, contributors see build before PR
+ <strong>Blame trail</strong>: git log shows when output changed and why (CI commit message references source change)</p>
</div>
<div class="paragraph">
<p><strong>Negative:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network required to see final outputs (mitigated: local preview extensions)</p>
</li>
<li>
<p>Slower feedback than local build (mitigated: preview extensions, small changes iterate locally)</p>
</li>
<li>
<p>CI quota consumption (mitigated: build only on source file changes)</p>
</li>
<li>
<p>Initial setup cost (one-time, then keeps working)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mitigations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>VS Code extensions preview PlantUML/OpenSCAD during editing (instant feedback)</p>
</li>
<li>
<p>Actions trigger only on paths: <code>openscad/<strong></code>, <code>images/</strong></code>, <code>kicad/**</code> (skip unrelated commits)</p>
</li>
<li>
<p>Local Docker containers available for manual iteration (same images CI uses)</p>
</li>
<li>
<p>Workflow continues on job failure: <code>continue-on-error: true</code> (partial build better than none)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_why_not_magic">4.1.5.3.5. Why Not Magic</h6>
<div class="paragraph">
<p>Actions EXPOSE process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># This is the build documentation. No hidden steps.
- name: Render
  run: |
    docker run ... openscad -o /w/build/openscad/$s.stl /w/$f</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compare to undocumented mental model:
- Author: "I open OpenSCAD, export STL, save PNG, commit both"
- New contributor: "Which settings? What colorscheme? Why this size?"
- Six months later: "How did I make this?"</p>
</div>
<div class="paragraph">
<p>Actions preserve intent. Author leaves. Process survives.</p>
</div>
</div>
<div class="sect5">
<h6 id="_workflow_structure">4.1.5.3.6. Workflow Structure</h6>
<div class="paragraph">
<p><code>cad-build.yml</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>openscad job</strong>: render STL + PNG for all <code>.scad</code> files</p>
</li>
<li>
<p><strong>plantuml job</strong>: render SVG for all <code>.puml</code> files</p>
</li>
<li>
<p><strong>kicad job</strong>: render PDF + SVG via KiBot</p>
</li>
<li>
<p><strong>publish job</strong>: commit outputs back to repo (ADR-001)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each job:
- Runs in isolation
- Uses pinned Docker image (versioned, reproducible)
- Continues on error (partial build survives)
- Logs exact commands (auditable)</p>
</div>
</div>
<div class="sect5">
<h6 id="_traceability_example">4.1.5.3.7. Traceability Example</h6>
<div class="paragraph">
<p>Commit: <code>fix: correct outer_len to 68mm</code></p>
</div>
<div class="paragraph">
<p>Actions runs → generates new STL → commits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ci: refresh outputs

Generated from:
- openscad/pb3-pack.scad (abc1234)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Git blame on <code>pb3-pack.stl</code> → points to CI commit → references source commit → full trace.</p>
</div>
<div class="paragraph">
<p>No "oops wrong image" mystery.</p>
</div>
</div>
<div class="sect5">
<h6 id="_living_documentation">4.1.5.3.8. Living Documentation</h6>
<div class="paragraph">
<p>Workflow file = build manual.</p>
</div>
<div class="paragraph">
<p>New contributor clones repo, reads <code>.github/workflows/cad-build.yml</code>, understands:
- Which Docker images
- Which commands
- Which outputs
- Which paths trigger</p>
</div>
<div class="paragraph">
<p>No MRI. No author interview. Just code.</p>
</div>
</div>
<div class="sect5">
<h6 id="_tools_vs_process">4.1.5.3.9. Tools vs Process</h6>
<div class="paragraph">
<p><strong>Local preview</strong>: VS Code extensions (instant feedback while editing)</p>
</div>
<div class="paragraph">
<p><strong>Canonical build</strong>: GitHub Actions (guarantees sync, documents process)</p>
</div>
<div class="paragraph">
<p>Both. Not either/or.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adr_004_file_extension_conventions_for_main_vs_include_files">4.1.5.4. ADR-004: File Extension Conventions for Main vs Include Files</h5>
<div class="paragraph">
<p>Date: 2025-12-12<br>
Status: Accepted</p>
</div>
<div class="sect5">
<h6 id="_context_4">4.1.5.4.1. Context</h6>
<div class="paragraph">
<p>Repos accumulate many AsciiDoc and PlantUML files. Finding the main entry point becomes hard. Need convention to distinguish "main documentation" from "included fragments" and "build sources" from "style imports".</p>
</div>
<div class="paragraph">
<p>Without convention:
- Which <code>.adoc</code> is the root doc?
- Which <code>.puml</code> gets rendered?
- Grep returns too many false positives</p>
</div>
</div>
<div class="sect5">
<h6 id="_decision_4">4.1.5.4.2. Decision</h6>
<div class="paragraph">
<p>Use extension suffixes to signal file role:</p>
</div>
<div class="paragraph">
<p><strong>AsciiDoc:</strong>
- <code>.asciidoc</code> = main documentation (entry points)
- <code>.adoc</code> = include fragments (not standalone)
- <code>includes/*.adoc</code> = shared fragments (glossary, copyright, formatting macros)</p>
</div>
<div class="paragraph">
<p><strong>PlantUML:</strong>
- <code>.plantuml</code> = diagrams to render
- <code>.puml</code> = style/config imports (not rendered)</p>
</div>
<div class="paragraph">
<p><strong>OpenSCAD:</strong>
- <code>.scad</code> = models to render
- <code>include-*.scad</code> = libraries (modules/functions only, skip rendering)</p>
</div>
<div class="paragraph">
<p><strong>Build outputs:</strong>
- Always adjacent to source (ADR-001)
- <code>docs/</code> = rendered AsciiDoc HTML only
- <code>.png</code>, <code>.stl</code>, <code>.svg</code> live next to <code>.scad</code>/<code>.plantuml</code></p>
</div>
</div>
<div class="sect5">
<h6 id="_alternatives_4">4.1.5.4.3. Alternatives</h6>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>All use same extension</strong></dt>
<dd>
<p>+ Simpler</p>
<div class="ulist">
<ul>
<li>
<p>No way to find main docs fast</p>
</li>
<li>
<p>Glob <code>*.adoc</code> catches 47 files</p>
</li>
<li>
<p>New contributor: "Which one do I read?"</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Separate directories</strong></dt>
<dd>
<p>+ Clear grouping: <code>main/</code>, <code>includes/</code></p>
<div class="ulist">
<ul>
<li>
<p>Breaks locality (main doc far from includes)</p>
</li>
<li>
<p>Path references fragile</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Metadata in filename</strong></dt>
<dd>
<p>+ Example: <code>README.main.adoc</code></p>
<div class="ulist">
<ul>
<li>
<p>Ugly</p>
</li>
<li>
<p>Sorting broken</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_implications_4">4.1.5.4.4. Implications</h6>
<div class="paragraph">
<p><strong>Positive:</strong></p>
</div>
<div class="paragraph">
<p>+ <code>find . -name "<strong>.asciidoc"</code> → main docs only
+ <code>find . -name "</strong>.plantuml"</code> → diagrams to render
+ CI glob: <code>images/*.plantuml</code> (ignores <code>common.puml</code> style)
+ New contributor sees <code>README.asciidoc</code> and knows: "Start here"
+ Include detection: <code>grep "^include::" *.adoc</code> finds fragments
+ Clear intent: <code>.asciidoc</code> = public, <code>.adoc</code> = internal</p>
</div>
<div class="paragraph">
<p><strong>Negative:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Convention not obvious without docs</p>
</li>
<li>
<p>Mix of extensions in directory listings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mitigations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Document in ADR (this file)</p>
</li>
<li>
<p>Enforce in CI: fail if <code>.asciidoc</code> includes another <code>.asciidoc</code></p>
</li>
<li>
<p>README mentions convention</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_examples_2">4.1.5.4.5. Examples</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>README.asciidoc                      ← main doc (read this first)
pb3-notes.asciidoc                   ← main workbook
adr/README.adoc                      ← include fragment (embedded in parent)
adr/adr-001-foo.adoc                 ← include fragment
includes/include-glossary.adoc       ← shared fragment (glossary)
includes/include-copyright.adoc      ← shared fragment (license boilerplate)

images/pb3-architecture.plantuml  ← render this
images/common.puml                ← style import (not rendered)

openscad/pb3-pack.scad            ← render this
openscad/include-utils.scad       ← library (skip rendering)
openscad/pb3-pack.png             ← output (adjacent)
openscad/pb3-pack.stl             ← output (adjacent)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_directory_structure">4.1.5.4.6. Directory Structure</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docs/                    ← HTML output from asciidoc rendering only
includes/                ← Shared AsciiDoc fragments (glossary, copyright, macros)
openscad/*.{png,stl}     ← CAD outputs (adjacent to .scad)
images/*.{png,svg}       ← diagram outputs (adjacent to .plantuml)
kicad/*.{pdf,svg}        ← schematic/PCB outputs (adjacent to .kicad_*)</code></pre>
</div>
</div>
<div class="paragraph">
<p>No generated artifacts in <code>docs/generated/</code>. That pattern is deprecated (ADR-001).</p>
</div>
</div>
<div class="sect5">
<h6 id="_ci_impact">4.1.5.4.7. CI Impact</h6>
<div class="paragraph">
<p>Workflows use extension filters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">for f in images/*.plantuml; do  # not *.puml
  plantuml "$f"
done

for f in openscad/*.scad; do
  [[ "$(basename "$f")" =~ ^include- ]] &amp;&amp; continue  # skip libraries
  openscad -o "${f%.scad}.stl" "$f"
  openscad -o "${f%.scad}.png" "$f"
done</code></pre>
</div>
</div>
<div class="paragraph">
<p>AsciiDoc rendering looks for <code>*.asciidoc</code> only.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adr_005_conditional_imagesdir_management_for_book_assembly">4.1.5.5. ADR-005: Conditional imagesdir Management for Book Assembly</h5>
<div class="paragraph">
<p>Date: 2025-12-12<br>
Status: Accepted</p>
</div>
<div class="sect5">
<h6 id="_context_5">4.1.5.5.1. Context</h6>
<div class="paragraph">
<p>README.asciidoc assembles multiple <code>.adoc</code> fragments that contain images. Each fragment must work both:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Standalone</strong>: rendered directly (GitHub, local preview)</p>
</li>
<li>
<p><strong>Included</strong>: assembled into main book</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Problem: image paths break when included.</p>
</div>
<div class="paragraph">
<p>Example:
- <code>images/README.adoc</code> contains <code>image::diagram.png[]</code>
- Standalone: works (PNG is local)
- Included in root README: fails (looks for <code>diagram.png</code> in root, not <code>images/</code>)</p>
</div>
<div class="paragraph">
<p>Need: conditional <code>:imagesdir:</code> that adapts to context without breaking either mode.</p>
</div>
</div>
<div class="sect5">
<h6 id="_decision_5">4.1.5.5.2. Decision</h6>
<div class="paragraph">
<p>Use <code>:flag-book:</code> to conditionally manage <code>:imagesdir:</code>.</p>
</div>
<div class="paragraph">
<p><strong>Main document (README.asciidoc):</strong></p>
</div>
<div class="listingblock">
<div class="title">Set book mode flag</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//:flag-book: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Each included fragment:</strong></p>
</div>
<div class="listingblock">
<div class="title">Save, override, restore imagesdir</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//ifdef::flag-book[]
//:imagesdir-save: {imagesdir}
//:imagesdir: &lt;subdirectory&gt;
//endif::[]
//
//... content with images ...
//
//ifdef::flag-book[]
//:imagesdir: {imagesdir-save}
//endif::[]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_alternatives_5">4.1.5.5.3. Alternatives</h6>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Absolute paths in image macros</strong></dt>
<dd>
<p>+ Works both standalone and included</p>
<div class="ulist">
<ul>
<li>
<p>Fragile (breaks on repo rename)</p>
</li>
<li>
<p>Verbose: <code>image::images/diagram.png[]</code> everywhere</p>
</li>
<li>
<p>Not idiomatic AsciiDoc</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Duplicate files</strong></dt>
<dd>
<p>+ Clean separation</p>
<div class="ulist">
<ul>
<li>
<p>Maintenance nightmare</p>
</li>
<li>
<p>Violates DRY</p>
</li>
<li>
<p>Drift guaranteed</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Separate standalone vs include versions</strong></dt>
<dd>
<p>+ Each optimized for context</p>
<div class="ulist">
<ul>
<li>
<p>Double maintenance</p>
</li>
<li>
<p>Violates single source of truth</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Always use subdirectory paths</strong></dt>
<dd>
<p>+ Simple</p>
<div class="ulist">
<ul>
<li>
<p>Breaks standalone rendering</p>
</li>
<li>
<p>GitHub can&#8217;t preview</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_implications_5">4.1.5.5.4. Implications</h6>
<div class="paragraph">
<p><strong>Positive:</strong></p>
</div>
<div class="paragraph">
<p>+ Single source: one <code>.adoc</code> file, two render contexts
+ Standalone works: <code>images/README.adoc</code> previews correctly on GitHub
+ Book works: <code>README.asciidoc</code> assembles all fragments with correct image paths
+ No path duplication: <code>image::foo.png[]</code> not <code>image::images/foo.png[]</code>
+ Graceful fallback: if <code>:flag-book:</code> not set, standalone mode assumed
+ Restores state: <code>:imagesdir-save:</code> preserves any parent setting</p>
</div>
<div class="paragraph">
<p><strong>Negative:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Boilerplate: every fragment needs ifdef blocks</p>
</li>
<li>
<p>Non-obvious: requires ADR to explain</p>
</li>
<li>
<p>Fragile: forget closing block = broken subsequent includes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mitigations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Document pattern in ADR (this file)</p>
</li>
<li>
<p>CI-generated READMEs include pattern automatically</p>
</li>
<li>
<p>Template in <code>includes/include-toc-standalone.adoc</code> for manual fragments</p>
</li>
<li>
<p>Lint rule: fail if <code>:imagesdir:</code> changed without restore</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_pattern">4.1.5.5.5. Pattern</h6>
<div class="paragraph">
<p><strong>Step 1: Main doc sets flag</strong></p>
</div>
<div class="listingblock">
<div class="title">Main document</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//= Main Document
//:flag-book: true
//
//include::subdoc/README.adoc[]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 2: Subdoc saves and overrides</strong></p>
</div>
<div class="listingblock">
<div class="title">Subdocument with conditional path</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//= Subdoc
//ifdef::flag-book[]
//:imagesdir-save: {imagesdir}
//:imagesdir: subdoc
//endif::[]
//
//image::photo.png[]  // standalone: subdoc/photo.png, book: subdoc/photo.png</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 3: Subdoc restores at end</strong></p>
</div>
<div class="listingblock">
<div class="title">Restore parent context</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//... last image ...
//
//ifdef::flag-book[]
//:imagesdir: {imagesdir-save}
//endif::[]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_files_using_pattern">4.1.5.5.6. Files Using Pattern</h6>
<div class="paragraph">
<p><strong>Manual:</strong>
- <code>measurements/README.adoc</code></p>
</div>
<div class="paragraph">
<p><strong>CI-generated:</strong>
- <code>images/README.adoc</code>
- <code>openscad/README.adoc</code></p>
</div>
<div class="paragraph">
<p><strong>Template:</strong>
- <code>includes/include-toc-standalone.adoc</code> (provides ifdef block)</p>
</div>
</div>
<div class="sect5">
<h6 id="_why_saverestore">4.1.5.5.7. Why Save/Restore</h6>
<div class="paragraph">
<p>Simple reset (<code>:imagesdir:</code>) loses parent context:</p>
</div>
<div class="listingblock">
<div class="title">Wrong: loses parent setting</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//:imagesdir: assets         // parent sets this
//
//include::sub/doc.adoc[]    // sub sets :imagesdir: sub, then resets to empty
//                           // WRONG: parent's "assets" is lost</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save/restore preserves nesting:</p>
</div>
<div class="listingblock">
<div class="title">Correct: preserves parent setting</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">//:imagesdir: assets
//
//include::sub/doc.adoc[]    // saves "assets", sets "sub", restores "assets"
//                           // CORRECT: parent context preserved</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enables arbitrary nesting depth without coordination.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_credits">5. Credits</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://stereo2go.com/forums/threads/rechargeable-battery-replacement-for-aiwa-pb-3-pb-4.9025/">Stereo2Go forum</a> — original research</p>
</li>
<li>
<p>OpenSCAD: <a href="https://github.com/donnels/openscad">ghcr.io/donnels/openscad:main</a></p>
</li>
<li>
<p>PlantUML: <a href="https://github.com/donnels/plantuml">ghcr.io/donnels/plantuml:main</a></p>
</li>
<li>
<p>KiBot: <a href="https://github.com/INTI-CMNB/KiBot">INTI-CMNB/KiBot@v2_dk8</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. In-house photo set <code>measurements/IMG_9373.jpeg</code>–<code>IMG_9385.jpeg</code>.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Rossoe et al., "Rechargeable battery replacement for AIWA PB-3 / PB-4," Stereo2Go forums, Sep 2023–Apr 2025. Offline copy: <code>research/Rechargeable battery replacement for AIWA PB-3 _ PB-4 _ Stereo2Go forums.html</code>. Original URL: <a href="https://stereo2go.com/forums/threads/rechargeable-battery-replacement-for-aiwa-pb-3-pb-4.9025/" class="bare">https://stereo2go.com/forums/threads/rechargeable-battery-replacement-for-aiwa-pb-3-pb-4.9025/</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-12-12 23:58:46 UTC
</div>
</div>
</body>
</html>